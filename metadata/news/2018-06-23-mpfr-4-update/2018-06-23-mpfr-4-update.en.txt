Title: dev-libs/mpfr 4 upgrade
Author: Matthias Maier <tamiko@gentoo.org>
Posted: 2018-06-23
Revision: 1
News-Item-Format: 2.0
Display-If-Installed: <dev-libs/mpfr-4

dev-libs/mpfr-4 introduced an ABI and soname change that has the potential
of breaking the compiler toolchain. In order to minimize potential problems
it is strongly recommended to rebuild mpc and gcc immediately after mpfr.
You can do this by running

  emerge --ask --oneshot ">=dev-libs/mpfr-4" dev-libs/mpc sys-devel/gcc

Detailed explanation:

libmpfr.so is used by libmpc.so (provided by dev-libs/mpc), as well as by
internal executables (e.g. cc1, cc1plus) of sys-devel/gcc. Appropriate
subslots in mpfr and slot-operators in dependencies in mpc and gcc will
cause a rebuild of mpc and gcc after an upgrade of mpfr.

However, after mpfr-4 is installed and mpc rebuiltd, but *before* gcc is
rebuilt, gcc will be in an inconsistent state wherein symbols from
incorrect library versions of mpfr might get used. This can result in
segfaults and internal compiler errors. It is therefore important to
rebuild gcc immmediately after mpc.

A detailed update guide with troubleshoot section can be found on the wiki:
https://wiki.gentoo.org/wiki/Mpfr4-update-guide
